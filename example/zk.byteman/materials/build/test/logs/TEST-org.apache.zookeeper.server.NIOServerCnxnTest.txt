Testsuite: org.apache.zookeeper.server.NIOServerCnxnTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.4 sec
------------- Standard Output ---------------
2015-05-21 15:08:33,478 [myid:] - INFO  [main:PortAssignment@32] - assigning port 11221
2015-05-21 15:08:33,486 [myid:] - INFO  [main:ZKTestCase$1@55] - STARTING testOperationsAfterCnxnClose
2015-05-21 15:08:33,488 [myid:] - INFO  [main:ClientBase@443] - Initial fdcount is: 46
2015-05-21 15:08:33,626 [myid:] - INFO  [main:ClientBase@461] - STARTING server
2015-05-21 15:08:33,627 [myid:] - INFO  [main:ClientBase@381] - CREATING server instance 127.0.0.1:11221
2015-05-21 15:08:33,639 [myid:] - INFO  [main:NIOServerCnxnFactory@673] - Configuring NIO connection handler with 10s sessionless connection timeout, 2 selector thread(s), 24 worker threads, and 64 kB direct buffers.
2015-05-21 15:08:33,643 [myid:] - INFO  [main:NIOServerCnxnFactory@686] - binding to port 0.0.0.0/0.0.0.0:11221
2015-05-21 15:08:33,644 [myid:] - INFO  [main:ClientBase@356] - STARTING server instance 127.0.0.1:11221
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:zookeeper.version=3.6.0-SNAPSHOT--1, built on 04/16/2015 06:13 GMT
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:host.name=mitake-jiseki-PC
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:java.version=1.7.0_75
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:java.vendor=Oracle Corporation
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:java.home=/usr/lib/jvm/java-7-openjdk-amd64/jre
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:java.class.path=/home/mitake/github/zookeeper.git/build/test/classes:/home/mitake/github/zookeeper.git/build/test/lib/antlr-2.7.6.jar:/home/mitake/github/zookeeper.git/build/test/lib/checkstyle-5.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-beanutils-core-1.7.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-cli-1.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-collections-2.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-lang-1.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-logging-1.0.3.jar:/home/mitake/github/zookeeper.git/build/test/lib/google-collections-0.9.jar:/home/mitake/github/zookeeper.git/build/test/lib/hamcrest-core-1.1.jar:/home/mitake/github/zookeeper.git/build/test/lib/junit-4.9.jar:/home/mitake/github/zookeeper.git/build/test/lib/mockito-all-1.8.2.jar:/home/mitake/github/zookeeper.git/build/classes:/home/mitake/github/zookeeper.git/src/java/lib/aspectjrt.jar:/home/mitake/github/zookeeper.git/src/java/lib/aspectjtools.jar:/home/mitake/github/zookeeper.git/src/java/lib/aspectjweaver.jar:/home/mitake/github/zookeeper.git/src/java/lib/ivy-2.2.0.jar:/home/mitake/github/zookeeper.git/src/java/lib/org.aspectj.matcher.jar:/home/mitake/github/zookeeper.git/src/java/lib/protobuf-java-2.6.1.jar:/usr/share/ant/lib/ant.jar:/home/mitake/github/zookeeper.git/build/lib/commons-cli-1.2.jar:/home/mitake/github/zookeeper.git/build/lib/jackson-core-asl-1.9.11.jar:/home/mitake/github/zookeeper.git/build/lib/jackson-mapper-asl-1.9.11.jar:/home/mitake/github/zookeeper.git/build/lib/javacc.jar:/home/mitake/github/zookeeper.git/build/lib/jetty-6.1.26.jar:/home/mitake/github/zookeeper.git/build/lib/jetty-util-6.1.26.jar:/home/mitake/github/zookeeper.git/build/lib/jline-2.11.jar:/home/mitake/github/zookeeper.git/build/lib/log4j-1.2.16.jar:/home/mitake/github/zookeeper.git/build/lib/netty-3.7.0.Final.jar:/home/mitake/github/zookeeper.git/build/lib/servlet-api-2.5-20081211.jar:/home/mitake/github/zookeeper.git/build/lib/slf4j-api-1.7.5.jar:/home/mitake/github/zookeeper.git/build/lib/slf4j-log4j12-1.7.5.jar:/usr/share/ant/lib/junit.jar:/usr/share/java/ant-launcher-1.9.3.jar:/usr/share/ant/lib/ant-junit.jar:/usr/share/ant/lib/ant-junit4.jar
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib
2015-05-21 15:08:33,649 [myid:] - INFO  [main:Environment@109] - Server environment:java.io.tmpdir=/tmp
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:java.compiler=<NA>
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:os.name=Linux
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:os.arch=amd64
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:os.version=3.13.0-45-generic
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:user.name=mitake
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:user.home=/home/mitake
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:user.dir=/home/mitake/github/zookeeper.git/build/test
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:os.memory.free=476MB
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:os.memory.max=491MB
2015-05-21 15:08:33,651 [myid:] - INFO  [main:Environment@109] - Server environment:os.memory.total=491MB
2015-05-21 15:08:33,660 [myid:] - INFO  [main:ZooKeeperServer@825] - minSessionTimeout set to 6000
2015-05-21 15:08:33,660 [myid:] - INFO  [main:ZooKeeperServer@834] - maxSessionTimeout set to 60000
2015-05-21 15:08:33,660 [myid:] - INFO  [main:ZooKeeperServer@156] - Created server with tickTime 3000 minSessionTimeout 6000 maxSessionTimeout 60000 datadir /home/mitake/github/zookeeper.git/build/test/tmp/test2047285991309632966.junit.dir/version-2 snapdir /home/mitake/github/zookeeper.git/build/test/tmp/test2047285991309632966.junit.dir/version-2
2015-05-21 15:08:33,664 [myid:] - INFO  [main:FileTxnSnapLog@298] - Snapshotting: 0x0 to /home/mitake/github/zookeeper.git/build/test/tmp/test2047285991309632966.junit.dir/version-2/snapshot.0
2015-05-21 15:08:33,680 [myid:] - INFO  [main:FourLetterWordMain@63] - connecting to 127.0.0.1 11221
2015-05-21 15:08:33,681 [myid:] - INFO  [NIOServerCxnFactory.AcceptThread:0.0.0.0/0.0.0.0:11221:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /127.0.0.1:44449
2015-05-21 15:08:33,684 [myid:] - INFO  [NIOWorkerThread-1:NIOServerCnxn@836] - Processing stat command from /127.0.0.1:44449
2015-05-21 15:08:33,685 [myid:] - INFO  [NIOWorkerThread-1:NIOServerCnxn$StatCommand@685] - Stat command output
2015-05-21 15:08:33,686 [myid:] - INFO  [NIOWorkerThread-1:NIOServerCnxn@1007] - Closed socket connection for client /127.0.0.1:44449 (no session established for client)
2015-05-21 15:08:33,686 [myid:] - INFO  [main:JMXEnv@224] - ensureParent:[InMemoryDataTree, StandaloneServer_port]
2015-05-21 15:08:33,692 [myid:] - INFO  [main:JMXEnv@241] - expect:InMemoryDataTree
2015-05-21 15:08:33,692 [myid:] - INFO  [main:JMXEnv@245] - found:InMemoryDataTree org.apache.ZooKeeperService:name0=StandaloneServer_port11221,name1=InMemoryDataTree
2015-05-21 15:08:33,693 [myid:] - INFO  [main:JMXEnv@241] - expect:StandaloneServer_port
2015-05-21 15:08:33,693 [myid:] - INFO  [main:JMXEnv@245] - found:StandaloneServer_port org.apache.ZooKeeperService:name0=StandaloneServer_port11221
2015-05-21 15:08:33,693 [myid:] - INFO  [main:ClientBase@457] - Client test setup finished
2015-05-21 15:08:33,694 [myid:] - INFO  [Thread-2:JUnit4ZKTestRunner$LoggedInvokeMethod@50] - RUNNING TEST METHOD testOperationsAfterCnxnClose
2015-05-21 15:08:33,699 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:zookeeper.version=3.6.0-SNAPSHOT--1, built on 04/16/2015 06:13 GMT
2015-05-21 15:08:33,699 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:host.name=mitake-jiseki-PC
2015-05-21 15:08:33,699 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.version=1.7.0_75
2015-05-21 15:08:33,699 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.vendor=Oracle Corporation
2015-05-21 15:08:33,699 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.home=/usr/lib/jvm/java-7-openjdk-amd64/jre
2015-05-21 15:08:33,699 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.class.path=/home/mitake/github/zookeeper.git/build/test/classes:/home/mitake/github/zookeeper.git/build/test/lib/antlr-2.7.6.jar:/home/mitake/github/zookeeper.git/build/test/lib/checkstyle-5.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-beanutils-core-1.7.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-cli-1.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-collections-2.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-lang-1.0.jar:/home/mitake/github/zookeeper.git/build/test/lib/commons-logging-1.0.3.jar:/home/mitake/github/zookeeper.git/build/test/lib/google-collections-0.9.jar:/home/mitake/github/zookeeper.git/build/test/lib/hamcrest-core-1.1.jar:/home/mitake/github/zookeeper.git/build/test/lib/junit-4.9.jar:/home/mitake/github/zookeeper.git/build/test/lib/mockito-all-1.8.2.jar:/home/mitake/github/zookeeper.git/build/classes:/home/mitake/github/zookeeper.git/src/java/lib/aspectjrt.jar:/home/mitake/github/zookeeper.git/src/java/lib/aspectjtools.jar:/home/mitake/github/zookeeper.git/src/java/lib/aspectjweaver.jar:/home/mitake/github/zookeeper.git/src/java/lib/ivy-2.2.0.jar:/home/mitake/github/zookeeper.git/src/java/lib/org.aspectj.matcher.jar:/home/mitake/github/zookeeper.git/src/java/lib/protobuf-java-2.6.1.jar:/usr/share/ant/lib/ant.jar:/home/mitake/github/zookeeper.git/build/lib/commons-cli-1.2.jar:/home/mitake/github/zookeeper.git/build/lib/jackson-core-asl-1.9.11.jar:/home/mitake/github/zookeeper.git/build/lib/jackson-mapper-asl-1.9.11.jar:/home/mitake/github/zookeeper.git/build/lib/javacc.jar:/home/mitake/github/zookeeper.git/build/lib/jetty-6.1.26.jar:/home/mitake/github/zookeeper.git/build/lib/jetty-util-6.1.26.jar:/home/mitake/github/zookeeper.git/build/lib/jline-2.11.jar:/home/mitake/github/zookeeper.git/build/lib/log4j-1.2.16.jar:/home/mitake/github/zookeeper.git/build/lib/netty-3.7.0.Final.jar:/home/mitake/github/zookeeper.git/build/lib/servlet-api-2.5-20081211.jar:/home/mitake/github/zookeeper.git/build/lib/slf4j-api-1.7.5.jar:/home/mitake/github/zookeeper.git/build/lib/slf4j-log4j12-1.7.5.jar:/usr/share/ant/lib/junit.jar:/usr/share/java/ant-launcher-1.9.3.jar:/usr/share/ant/lib/ant-junit.jar:/usr/share/ant/lib/ant-junit4.jar
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.io.tmpdir=/tmp
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:java.compiler=<NA>
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:os.name=Linux
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:os.arch=amd64
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:os.version=3.13.0-45-generic
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:user.name=mitake
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:user.home=/home/mitake
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:user.dir=/home/mitake/github/zookeeper.git/build/test
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:os.memory.free=467MB
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:os.memory.max=491MB
2015-05-21 15:08:33,700 [myid:] - INFO  [Thread-2:Environment@109] - Client environment:os.memory.total=491MB
2015-05-21 15:08:33,702 [myid:] - INFO  [Thread-2:ZooKeeper@717] - Initiating client connection, connectString=127.0.0.1:11221 sessionTimeout=30000 watcher=org.apache.zookeeper.test.ClientBase$CountdownWatcher@711fee78
2015-05-21 15:08:33,711 [myid:] - INFO  [Thread-2-SendThread(127.0.0.1:11221):ClientCnxn$SendThread@1096] - Opening socket connection to server 127.0.0.1/127.0.0.1:11221. Will not attempt to authenticate using SASL (unknown error)
2015-05-21 15:08:33,712 [myid:] - INFO  [NIOServerCxnFactory.AcceptThread:0.0.0.0/0.0.0.0:11221:NIOServerCnxnFactory$AcceptThread@296] - Accepted socket connection from /127.0.0.1:44450
2015-05-21 15:08:33,712 [myid:] - INFO  [Thread-2-SendThread(127.0.0.1:11221):ClientCnxn$SendThread@968] - Socket connection established, initiating session, client: /127.0.0.1:44450, server: 127.0.0.1/127.0.0.1:11221
2015-05-21 15:08:33,714 [myid:] - INFO  [NIOWorkerThread-2:ZooKeeperServer@931] - Client attempting to establish new session at /127.0.0.1:44450
2015-05-21 15:08:33,716 [myid:] - INFO  [SyncThread:0:FileTxnLog@200] - Creating new log file: log.1
2015-05-21 15:08:33,740 [myid:] - INFO  [SyncThread:0:ZooKeeperServer@645] - Established session 0x1000621ffa40000 with negotiated timeout 30000 for client /127.0.0.1:44450
2015-05-21 15:08:33,741 [myid:] - INFO  [Thread-2-SendThread(127.0.0.1:11221):ClientCnxn$SendThread@1357] - Session establishment complete on server 127.0.0.1/127.0.0.1:11221, sessionid = 0x1000621ffa40000, negotiated timeout = 30000
2015-05-21 15:08:33,744 [myid:] - INFO  [Thread-2:JMXEnv@113] - expect:0x1000621ffa40000
2015-05-21 15:08:33,744 [myid:] - INFO  [Thread-2:JMXEnv@116] - found:0x1000621ffa40000 org.apache.ZooKeeperService:name0=StandaloneServer_port11221,name1=Connections,name2=127.0.0.1,name3=0x1000621ffa40000
2015-05-21 15:08:33,761 [myid:] - INFO  [Thread-2:MBeanRegistry@119] - Unregister MBean [org.apache.ZooKeeperService:name0=StandaloneServer_port11221,name1=Connections,name2=127.0.0.1,name3=0x1000621ffa40000]
2015-05-21 15:08:33,761 [myid:] - INFO  [Thread-2:NIOServerCnxn@1007] - Closed socket connection for client /127.0.0.1:44450 which had sessionid 0x1000621ffa40000
2015-05-21 15:08:33,863 [myid:] - INFO  [Thread-2:ZooKeeper@1111] - Session: 0x1000621ffa40000 closed
2015-05-21 15:08:33,863 [myid:] - INFO  [Thread-2:JUnit4ZKTestRunner$LoggedInvokeMethod@55] - Memory used 37780
2015-05-21 15:08:33,863 [myid:] - INFO  [Thread-2-EventThread:ClientCnxn$EventThread@531] - EventThread shut down
2015-05-21 15:08:33,863 [myid:] - INFO  [Thread-2:JUnit4ZKTestRunner$LoggedInvokeMethod@60] - Number of threads 29
2015-05-21 15:08:33,863 [myid:] - INFO  [Thread-2:JUnit4ZKTestRunner$LoggedInvokeMethod@65] - FINISHED TEST METHOD testOperationsAfterCnxnClose
2015-05-21 15:08:33,864 [myid:] - INFO  [main:ClientBase@538] - tearDown starting
2015-05-21 15:08:33,864 [myid:] - INFO  [main:ClientBase@508] - STOPPING server
2015-05-21 15:08:33,865 [myid:] - INFO  [ConnnectionExpirer:NIOServerCnxnFactory$ConnectionExpirerThread@583] - ConnnectionExpirerThread interrupted
2015-05-21 15:08:33,865 [myid:] - INFO  [NIOServerCxnFactory.SelectorThread-0:NIOServerCnxnFactory$SelectorThread@420] - selector thread exitted run method
2015-05-21 15:08:33,865 [myid:] - INFO  [NIOServerCxnFactory.AcceptThread:0.0.0.0/0.0.0.0:11221:NIOServerCnxnFactory$AcceptThread@219] - accept thread exitted run method
2015-05-21 15:08:33,865 [myid:] - INFO  [NIOServerCxnFactory.SelectorThread-1:NIOServerCnxnFactory$SelectorThread@420] - selector thread exitted run method
2015-05-21 15:08:33,866 [myid:] - INFO  [main:ZooKeeperServer@465] - shutting down
2015-05-21 15:08:33,866 [myid:] - INFO  [main:SessionTrackerImpl@232] - Shutting down
2015-05-21 15:08:33,866 [myid:] - INFO  [main:PrepRequestProcessor@973] - Shutting down
2015-05-21 15:08:33,866 [myid:] - INFO  [main:SyncRequestProcessor@191] - Shutting down
2015-05-21 15:08:33,866 [myid:] - INFO  [ProcessThread(sid:0 cport:11221)::PrepRequestProcessor@155] - PrepRequestProcessor exited loop!
2015-05-21 15:08:33,866 [myid:] - INFO  [SyncThread:0:SyncRequestProcessor@169] - SyncRequestProcessor exited!
2015-05-21 15:08:33,866 [myid:] - INFO  [main:FinalRequestProcessor@489] - shutdown of request processor complete
2015-05-21 15:08:33,866 [myid:] - INFO  [main:MBeanRegistry@119] - Unregister MBean [org.apache.ZooKeeperService:name0=StandaloneServer_port11221,name1=InMemoryDataTree]
2015-05-21 15:08:33,866 [myid:] - INFO  [main:MBeanRegistry@119] - Unregister MBean [org.apache.ZooKeeperService:name0=StandaloneServer_port11221]
2015-05-21 15:08:33,867 [myid:] - INFO  [main:FourLetterWordMain@63] - connecting to 127.0.0.1 11221
2015-05-21 15:08:33,867 [myid:] - INFO  [main:JMXEnv@142] - ensureOnly:[]
2015-05-21 15:08:33,869 [myid:] - INFO  [main:ClientBase@563] - fdcount after test is: 54 at start it was 46
2015-05-21 15:08:33,869 [myid:] - INFO  [main:ClientBase@565] - sleeping for 20 secs
2015-05-21 15:08:33,869 [myid:] - INFO  [main:ZKTestCase$1@65] - SUCCEEDED testOperationsAfterCnxnClose
2015-05-21 15:08:33,870 [myid:] - INFO  [main:ZKTestCase$1@60] - FINISHED testOperationsAfterCnxnClose
------------- ---------------- ---------------

Testcase: testOperationsAfterCnxnClose took 0.384 sec
